(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/car/car"],{5109:function(t,a,i){"use strict";var s=i("770c"),e=i.n(s);e.a},"770c":function(t,a,i){},"9eb7":function(t,a,i){"use strict";i.r(a);var s=i("e0be"),e=i.n(s);for(var c in s)"default"!==c&&function(t){i.d(a,t,function(){return s[t]})}(c);a["default"]=e.a},c2f6:function(t,a,i){"use strict";i.r(a);var s=i("f414"),e=i("9eb7");for(var c in e)"default"!==c&&function(t){i.d(a,t,function(){return e[t]})}(c);i("5109");var n=i("2877"),o=Object(n["a"])(e["default"],s["a"],s["b"],!1,null,null,null);a["default"]=o.exports},e0be:function(t,a,i){"use strict";(function(t){Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var i={data:function(){return{isselectedall:!0,scrollposition:0,cart:[],mch_list:[{mch_id:"",goods_list:[]}],ordercart:[],buymore:[],list:[],goods_list:[],index:[],itemrecommend:[],totalamount:0,cntitems:0,shownullcart:!1}},onLoad:function(){var a=this;a.$access_token=t.getStorageSync("access_token"),a.$level=t.getStorageSync("level"),a.isselectedall=!0,setTimeout(function(){t.request({url:a.$api+"cart/list&access_token="+a.$access_token,method:"GET",success:function(t){var i=[],s=t.data.data.list;for(var e in a.list=t.data.data.list,a.list)a.list[e].checked=!0;for(var c in console.log(a.list," at pages\\car\\car.vue:130"),s)i.push({id:s[c].cart_id,goods_id:s[c].goods_id,name:s[c].goods_name,imgsrc:s[c].goods_pic,quantity:s[c].num,price:s[c].unitPrice,attr_list:s[c].attr_list,max_num:s[c].max_num});a.cart=i;for(var n=0;n<a.cart.length;n++)a.totalamount=a.totalamount+a.cart[n].price*a.cart[n].quantity,a.cntitems=a.cntitems+a.cart[n].quantity,a.index.push(n),a.goods_list.push({cart_id:a.cart[n].id});a.totalamount=a.fmamount(a.totalamount),console.log(a.goods_list," at pages\\car\\car.vue:157"),0==a.cart.length?a.shownullcart=!0:a.shownullcart=!1},fail:function(){}})},1e3),t.startPullDownRefresh(this.cart)},onPullDownRefresh:function(){var a=this;a.scrollhoming(),setTimeout(function(){t.request({url:a.$api+"cart/list&access_token="+a.$access_token,method:"GET",success:function(t){var i=[],s=t.data.data.list;for(var e in a.list=t.data.data.list,a.list)a.list[e].checked=!0;for(var c in console.log(a.list," at pages\\car\\car.vue:203"),s)i.push({id:s[c].cart_id,goods_id:s[c].goods_id,name:s[c].goods_name,imgsrc:s[c].goods_pic,quantity:s[c].num,price:s[c].unitPrice,attr_list:s[c].attr_list,max_num:s[c].max_num});a.cart=i,a.totalamount=0;for(var n=0;n<a.cart.length;n++)a.totalamount=a.totalamount+a.cart[n].price*a.cart[n].quantity,a.cntitems=a.cntitems+a.cart[n].quantity,a.index.push(n),a.goods_list.push({cart_id:a.cart[n].id});a.totalamount=a.fmamount(a.totalamount),a.isselectedall=!0},fail:function(){}}),t.stopPullDownRefresh()},1e3)},computed:{},beforeDestroy:function(){try{t.setStorageSync("cart",this.cart)}catch(a){}},methods:{toStore:function(){t.reLaunch({url:"/pages/store/store"})},scrollhoming:function(){this.scrollposition=this.scrollposition-1},scrollhomed:function(){this.scrollposition=0},clickitemselectedall:function(){if(this.isselectedall=!this.isselectedall,this.isselectedall){if(this.cart)for(var t=0;t<this.cart.length;t++)this.cart[t].id<0&&(this.cart[t].id=-this.cart[t].id,this.cntitems=this.cntitems+this.cart[t].quantity,this.totalamount=this.totalamount+this.cart[t].price*this.cart[t].quantity,this.totalamount=this.fmamount(this.totalamount))}else if(this.cart)for(t=0;t<this.cart.length;t++)this.isselected(this.cart[t].id)&&(this.cart[t].id=-this.cart[t].id,this.cntitems=this.cntitems-this.cart[t].quantity,this.totalamount=this.totalamount-this.cart[t].price*this.cart[t].quantity,this.totalamount=this.fmamount(this.totalamount))},clickitemselected:function(t,a){if(this.cart)for(var i=0;i<this.cart.length;i++)if(this.cart[i].id==t)return this.cart[i].id=-this.cart[i].id,this.isselected(this.cart[i].id)?(this.cntitems=this.cntitems+this.cart[i].quantity,this.totalamount=this.totalamount+this.cart[i].price*this.cart[i].quantity,this.totalamount=this.fmamount(this.totalamount),this._isselectedall()&&(this.isselectedall=!0,this.cart[i].checked=!1)):(this.cntitems=this.cntitems-this.cart[i].quantity,this.totalamount=this.totalamount-this.cart[i].price*this.cart[i].quantity,this.totalamount=this.fmamount(this.totalamount),this.isselectedall=!1,this.cart[i].checked=!0),!1},clickdel:function(a){var i=this,s=[];s.push(a),console.log(s," at pages\\car\\car.vue:359"),t.showModal({title:"提示",content:"确定删除该商品？",success:function(e){e.confirm&&t.request({url:i.$api+"cart/delete&access_token="+i.$access_token,data:{cart_id_list:JSON.stringify(s)},method:"GET",dataType:"json",header:{"content-type":"application/x-www-form-urlencoded"},success:function(s){t.showToast({title:s.data.msg,icon:"none"}),t.startPullDownRefresh();for(var e=0;e<i.cart.length;e++)if(i.cart[e].id==a)return i.isselected(i.cart[e].id)?(i.cntitems=i.cntitems-i.cart[e].quantity,i.totalamount=i.totalamount-i.cart[e].price*i.cart[e].quantity,i.totalamount=i.fmamount(i.totalamount),i.cart[e].id=-99-a):i.cart[e].id=-99+a,i._isdeledall()&&(i.shownullcart=!0,i.isselectedall=!1),!1},fail:function(a){t.showToast({title:a.data.msg,icon:"none"})}})}})},minusitem:function(t){for(var a=0;a<this.cart.length;a++)if(this.cart[a].id==t&&this.cart[a].quantity>0)return this.cart[a].quantity=this.cart[a].quantity-1,this.list[a].num=this.cart[a].quantity,console.log(this.list[a].num," at pages\\car\\car.vue:426"),this.isselected(this.cart[a].id)&&(this.updatecntitems(-1),this.updatetotalamt(-this.cart[a].price)),void(0==this.cart[a].quantity&&(this.cart[a].id=this._unselected(this.cart[a].id)))},plusitem:function(a){for(var i=0;i<this.cart.length;i++)if(this.cart[i].id==a&&this.cart[i].quantity<100)return console.log(this.cart[i].quantity," at pages\\car\\car.vue:448"),console.log(this.cart[i].max_num," at pages\\car\\car.vue:449"),this.list[i].num>=this.cart[i].max_num?(t.showToast({title:"该商品库存不足",icon:"none"}),!1):(this.cart[i].quantity=this.cart[i].quantity+1,this.list[i].num=this.cart[i].quantity,this.list[i].num=this.cart[i].quantity,console.log(this.list[i].num," at pages\\car\\car.vue:460"),this.isselected(this.cart[i].id)?(this.updatecntitems(1),this.updatetotalamt(this.cart[i].price)):(this.cart[i].id=this._selected(this.cart[i].id),this.cntitems=this.cntitems+this.cart[i].quantity,this.totalamount=this.totalamount+this.cart[i].price*this.cart[i].quantity,this.totalamount=this.fmamount(this.totalamount)),void(this._isselectedall()&&(this.isselectedall=!0)))},clickitemhref:function(a){t.navigateTo({url:"/pages/store_detail/store_detail?id="+a})},updatetotalamt:function(t){this.totalamount=this.totalamount+t,this.totalamount=this.fmamount(this.totalamount)},updatecntitems:function(t){this.cntitems=this.cntitems+t},fmamount:function(t){return Math.round(100*t)/100},_unselected:function(t){return-Math.abs(t)},_selected:function(t){return Math.abs(t)},isselected:function(t){return t>0},_isselectedall:function(){for(var t=0;t<this.cart.length;t++)if(this.cart[t].id<0)return!1;return!0},_isdeledall:function(){for(var t=0;t<this.cart.length;t++)if(this.cart[t].id>-99)return!1;return!0},createorder:function(){var a=this;if(console.log(a.totalamount," at pages\\car\\car.vue:552"),0==a.totalamount)t.showModal({content:"请选择下单的商品！"});else{for(var i=[],s=[],e=0;e<a.cart.length;e++)a.cart[e].id>0&&(i.push(a.cart[e].id),s.push(e));console.log(i," at pages\\car\\car.vue:571"),console.log(s," at pages\\car\\car.vue:572");for(var c=function(e){console.log(a.list[e]," at pages\\car\\car.vue:574"),console.log(a.list[e]," at pages\\car\\car.vue:576"),t.request({url:a.$api+"cart/cart-edit&access_token="+a.$access_token,method:"POST",data:{list:JSON.stringify([a.list[s[e]]]),mch_list:JSON.stringify([])},dataType:"json",header:{"content-type":"application/x-www-form-urlencoded"},success:function(c){if(0==c.data.code){var n=[];console.log(i.length," at pages\\car\\car.vue:591");for(var o=0;o<i.length;o++)n.push({cart_id:i[o]});a.mch_list[0].mch_id=0,a.mch_list[0].goods_list=n,e==s.length-1&&(console.log(e," at pages\\car\\car.vue:600"),t.request({url:a.$api+"order/new-submit-preview&access_token="+a.$access_token,method:"POST",data:{mch_list:JSON.stringify(a.mch_list)},dataType:"json",header:{"content-type":"application/x-www-form-urlencoded"},success:function(a){if(1==a.data.code)return t.showToast({title:a.data.msg,icon:"none"}),!1;setTimeout(function(){t.navigateTo({url:"/pages/account/account?data="+JSON.stringify(a.data.data)})},1e3)}}))}else t.showToast({title:c.data.msg,icon:"none",duration:1500})}})},n=0;n<s.length;n++)c(n)}}}};a.default=i}).call(this,i("6e42")["default"])},f414:function(t,a,i){"use strict";var s=function(){var t=this,a=t.$createElement;t._self._c},e=[];i.d(a,"a",function(){return s}),i.d(a,"b",function(){return e})}},[["461b","common/runtime","common/vendor"]]]);