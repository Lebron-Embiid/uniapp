(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/car/car"],{"3c40":function(t,i,e){"use strict";var s=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("view",{staticClass:"glance-shop-cart",staticStyle:{"background-color":"#F5F5F5"},attrs:{eventid:"25e13096-10"},on:{touchmove:t.scrollhoming,touchend:t.scrollhomed}},[t.shownullcart?e("view",{staticStyle:{width:"100%",height:"250px",background:"#fff","padding-top":"300rpx"},attrs:{eventid:"25e13096-0"},on:{click:t.toStore}},[e("view",{staticClass:"glance-shop-cart-nullcart"}),e("view",{staticStyle:{height:"30px",width:"100%","font-size":"15px","line-height":"30px","text-align":"center",color:"#025aa5"}},[t._v("您的购物车为空，快去商城添加商品吧！")])]):t._e(),t._l(t.cart,function(i,s){return t.shownullcart?t._e():e("view",{key:s,staticStyle:{"background-color":"#FFFFFF"}},[e("view",[e("scroll-view",{staticStyle:{width:"100%","white-space":"nowrap","border-bottom":"1px solid #F6F6F6"},attrs:{"scroll-x":"true","scroll-left":t.scrollposition,"scroll-with-animation":"true"}},[e("view",{staticClass:"glance-shop-cart-scrollx-items",staticStyle:{display:"inline-block",width:"100%"}},[e("view",{staticClass:"glance-shop-cart-scrollx-items-item"},[e("view",{staticStyle:{width:"10%",height:"100%","background-color":"#FFFFFF"}},[e("view",{staticClass:"glance-shop-cart-scrollx-items-item-sel",class:[i.id>0?"glance-shop-cart-itemselected-img":"glance-shop-cart-itemunselected-img"],attrs:{eventid:"25e13096-1-"+s},on:{click:function(e){t.clickitemselected(i.id,s)}}})]),e("view",{staticStyle:{width:"25%",height:"100%","text-align":"center"}},[e("image",{staticStyle:{height:"75px",width:"75px","line-height":"80px","padding-top":"5px"},attrs:{src:i.imgsrc,mode:"scaleToFill",eventid:"25e13096-2-"+s},on:{click:function(e){t.clickitemhref(i.goods_id)}}})]),e("view",{staticClass:"glance-shop-cart-items-item-des"},[e("view",{staticClass:"sigle-line-text",staticStyle:{color:"#1f1f1f","font-size":"28rpx",height:"33.33%","text-align":"left"},attrs:{eventid:"25e13096-3-"+s},on:{click:function(e){t.clickitemhref(i.goods_id)}}},[t._v(t._s(i.name))]),e("view",{staticClass:"sigle-line-text",staticStyle:{color:"#747474","font-size":"22rpx",height:"33.33%","text-align":"left"},attrs:{eventid:"25e13096-4-"+s},on:{click:function(e){t.clickitemhref(i.goods_id)}}},t._l(i.attr_list,function(i,s){return e("text",{key:s,staticStyle:{"margin-right":"10rpx"}},[t._v(t._s(i.attr_group_name)+": "+t._s(i.attr_name))])})),e("view",{staticClass:"glance-shop-cart-items-item-pq"},[e("view",{staticClass:"sigle-line-text1",staticStyle:{color:"#fa3930","font-size":"26rpx","text-align":"left",width:"50%"}},[t._v("￥"+t._s(i.price))]),e("view",{staticClass:"glance-shop-cart-items-item-opt"},[e("view",{staticClass:"glance-shop-cart-items-item-opt-quantity-minus",attrs:{eventid:"25e13096-5-"+s},on:{click:function(e){t.minusitem(i.id)}}},[t._v("-")]),e("view",{staticClass:"glance-shop-cart-items-item-opt-quantity"},[t._v(t._s(i.quantity))]),e("view",{staticClass:"glance-shop-cart-items-item-opt-quantity-plus",attrs:{eventid:"25e13096-6-"+s},on:{click:function(e){t.plusitem(i.id)}}},[t._v("+")])])])])])]),e("view",{staticClass:"glance-shop-cart-del",attrs:{eventid:"25e13096-7-"+s},on:{click:function(e){t.clickdel(i.id)}}},[e("view",{staticClass:"glance-shop-cart-del-img"})])])],1)])}),t.shownullcart?t._e():e("view",{staticClass:"glance-shop-cart-order"},[e("view",{staticStyle:{width:"9%"}},[e("view",{staticClass:"glance-shop-cart-scrollx-items-item-sel",class:[t.isselectedall?"glance-shop-cart-itemselected-img":"glance-shop-cart-itemunselected-img"],attrs:{eventid:"25e13096-8"},on:{click:t.clickitemselectedall}})]),e("view",{staticClass:"glance-shop-cart-total-cnt"},[t._v("全选")]),e("view",{staticClass:"glance-shop-cart-total-amt"},[t._v("总计：￥"+t._s(t.totalamount))]),e("view",{staticClass:"glance-shop-cart-create-order",attrs:{eventid:"25e13096-9"},on:{click:t.createorder}},[t._v("结算")])])],2)},a=[];e.d(i,"a",function(){return s}),e.d(i,"b",function(){return a})},"461b":function(t,i,e){"use strict";e("1a7f");var s=c(e("b0ce")),a=c(e("c2f6"));function c(t){return t&&t.__esModule?t:{default:t}}Page((0,s.default)(a.default))},5109:function(t,i,e){"use strict";var s=e("770c"),a=e.n(s);a.a},"770c":function(t,i,e){},"9eb7":function(t,i,e){"use strict";e.r(i);var s=e("fbe4"),a=e.n(s);for(var c in s)"default"!==c&&function(t){e.d(i,t,function(){return s[t]})}(c);i["default"]=a.a},c2f6:function(t,i,e){"use strict";e.r(i);var s=e("3c40"),a=e("9eb7");for(var c in a)"default"!==c&&function(t){e.d(i,t,function(){return a[t]})}(c);e("5109");var n=e("2877"),o=Object(n["a"])(a["default"],s["a"],s["b"],!1,null,null,null);i["default"]=o.exports},fbe4:function(t,i,e){"use strict";(function(t){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var e={data:function(){return{isselectedall:!0,scrollposition:0,cart:[],mch_list:[{mch_id:"",goods_list:[]}],ordercart:[],buymore:[],list:[],goods_list:[],index:[],itemrecommend:[],totalamount:0,cntitems:0,shownullcart:!1}},onLoad:function(){var i=this;i.$access_token=t.getStorageSync("access_token"),i.$level=t.getStorageSync("level"),i.isselectedall=!0,setTimeout(function(){t.request({url:i.$api+"cart/list&access_token="+i.$access_token,method:"GET",success:function(t){var e=[],s=t.data.data.list;for(var a in i.list=t.data.data.list,i.list)i.list[a].checked=!0;for(var c in console.log(i.list),s)e.push({id:s[c].cart_id,goods_id:s[c].goods_id,name:s[c].goods_name,imgsrc:s[c].goods_pic,quantity:s[c].num,price:s[c].unitPrice,attr_list:s[c].attr_list,max_num:s[c].max_num});i.cart=e;for(var n=0;n<i.cart.length;n++)i.totalamount=i.totalamount+i.cart[n].price*i.cart[n].quantity,i.cntitems=i.cntitems+i.cart[n].quantity,i.index.push(n),i.goods_list.push({cart_id:i.cart[n].id});i.totalamount=i.fmamount(i.totalamount),console.log(i.goods_list),0==i.cart.length?i.shownullcart=!0:i.shownullcart=!1},fail:function(){}})},1e3),t.startPullDownRefresh(this.cart)},onPullDownRefresh:function(){var i=this;i.scrollhoming(),setTimeout(function(){t.request({url:i.$api+"cart/list&access_token="+i.$access_token,method:"GET",success:function(t){var e=[],s=t.data.data.list;for(var a in i.list=t.data.data.list,i.list)i.list[a].checked=!0;for(var c in console.log(i.list),s)e.push({id:s[c].cart_id,goods_id:s[c].goods_id,name:s[c].goods_name,imgsrc:s[c].goods_pic,quantity:s[c].num,price:s[c].unitPrice,attr_list:s[c].attr_list,max_num:s[c].max_num});i.cart=e,i.totalamount=0;for(var n=0;n<i.cart.length;n++)i.totalamount=i.totalamount+i.cart[n].price*i.cart[n].quantity,i.cntitems=i.cntitems+i.cart[n].quantity,i.index.push(n),i.goods_list.push({cart_id:i.cart[n].id});i.totalamount=i.fmamount(i.totalamount),i.isselectedall=!0},fail:function(){}}),t.stopPullDownRefresh()},1e3)},computed:{},beforeDestroy:function(){try{t.setStorageSync("cart",this.cart)}catch(i){}},methods:{toStore:function(){t.reLaunch({url:"/pages/store/store"})},scrollhoming:function(){this.scrollposition=this.scrollposition-1},scrollhomed:function(){this.scrollposition=0},clickitemselectedall:function(){if(this.isselectedall=!this.isselectedall,this.isselectedall){if(this.cart)for(var t=0;t<this.cart.length;t++)this.cart[t].id<0&&(this.cart[t].id=-this.cart[t].id,this.cntitems=this.cntitems+this.cart[t].quantity,this.totalamount=this.totalamount+this.cart[t].price*this.cart[t].quantity,this.totalamount=this.fmamount(this.totalamount))}else if(this.cart)for(t=0;t<this.cart.length;t++)this.isselected(this.cart[t].id)&&(this.cart[t].id=-this.cart[t].id,this.cntitems=this.cntitems-this.cart[t].quantity,this.totalamount=this.totalamount-this.cart[t].price*this.cart[t].quantity,this.totalamount=this.fmamount(this.totalamount))},clickitemselected:function(t,i){if(this.cart)for(var e=0;e<this.cart.length;e++)if(this.cart[e].id==t)return this.cart[e].id=-this.cart[e].id,this.isselected(this.cart[e].id)?(this.cntitems=this.cntitems+this.cart[e].quantity,this.totalamount=this.totalamount+this.cart[e].price*this.cart[e].quantity,this.totalamount=this.fmamount(this.totalamount),this._isselectedall()&&(this.isselectedall=!0,this.cart[e].checked=!1)):(this.cntitems=this.cntitems-this.cart[e].quantity,this.totalamount=this.totalamount-this.cart[e].price*this.cart[e].quantity,this.totalamount=this.fmamount(this.totalamount),this.isselectedall=!1,this.cart[e].checked=!0),!1},clickdel:function(i){var e=this,s=[];s.push(i),console.log(s),t.showModal({title:"提示",content:"确定删除该商品？",success:function(a){a.confirm&&t.request({url:e.$api+"cart/delete&access_token="+e.$access_token,data:{cart_id_list:JSON.stringify(s)},method:"GET",dataType:"json",header:{"content-type":"application/x-www-form-urlencoded"},success:function(s){t.showToast({title:s.data.msg,icon:"none",duration:2e3});for(var a=0;a<e.cart.length;a++)if(e.cart[a].id==i)return e.isselected(e.cart[a].id)?(e.cntitems=e.cntitems-e.cart[a].quantity,e.totalamount=e.totalamount-e.cart[a].price*e.cart[a].quantity,e.totalamount=e.fmamount(e.totalamount),e.cart[a].id=-99-i):e.cart[a].id=-99+i,e._isdeledall()&&(e.shownullcart=!0,e.isselectedall=!1),!1},fail:function(i){t.showToast({title:i.data.msg,icon:"none"})}})}})},minusitem:function(t){for(var i=0;i<this.cart.length;i++)if(this.cart[i].id==t&&this.cart[i].quantity>0)return this.cart[i].quantity=this.cart[i].quantity-1,this.list[i].num=this.cart[i].quantity,console.log(this.list[i].num),this.isselected(this.cart[i].id)&&(this.updatecntitems(-1),this.updatetotalamt(-this.cart[i].price)),void(0==this.cart[i].quantity&&(this.cart[i].id=this._unselected(this.cart[i].id)))},plusitem:function(i){for(var e=0;e<this.cart.length;e++)if(this.cart[e].id==i&&this.cart[e].quantity<100)return console.log(this.cart[e].quantity),console.log(this.cart[e].max_num),this.list[e].num>=this.cart[e].max_num?(t.showToast({title:"该商品库存不足",icon:"none"}),!1):(this.cart[e].quantity=this.cart[e].quantity+1,this.list[e].num=this.cart[e].quantity,this.list[e].num=this.cart[e].quantity,console.log(this.list[e].num),this.isselected(this.cart[e].id)?(this.updatecntitems(1),this.updatetotalamt(this.cart[e].price)):(this.cart[e].id=this._selected(this.cart[e].id),this.cntitems=this.cntitems+this.cart[e].quantity,this.totalamount=this.totalamount+this.cart[e].price*this.cart[e].quantity,this.totalamount=this.fmamount(this.totalamount)),void(this._isselectedall()&&(this.isselectedall=!0)))},clickitemhref:function(i){t.navigateTo({url:"/pages/store_detail/store_detail?id="+i})},updatetotalamt:function(t){this.totalamount=this.totalamount+t,this.totalamount=this.fmamount(this.totalamount)},updatecntitems:function(t){this.cntitems=this.cntitems+t},fmamount:function(t){return Math.round(100*t)/100},_unselected:function(t){return-Math.abs(t)},_selected:function(t){return Math.abs(t)},isselected:function(t){return t>0},_isselectedall:function(){for(var t=0;t<this.cart.length;t++)if(this.cart[t].id<0)return!1;return!0},_isdeledall:function(){for(var t=0;t<this.cart.length;t++)if(this.cart[t].id>-99)return!1;return!0},createorder:function(){var i=this;if(console.log(i.totalamount),0==i.totalamount)t.showModal({content:"请选择下单的商品！"});else{for(var e=[],s=[],a=0;a<i.cart.length;a++)i.cart[a].id>0&&(e.push(i.cart[a].id),s.push(a));console.log(e),console.log(s);for(var c=function(a){console.log(i.list[a]),console.log(i.list[a]),t.request({url:i.$api+"cart/cart-edit&access_token="+i.$access_token,method:"POST",data:{list:JSON.stringify([i.list[s[a]]]),mch_list:JSON.stringify([])},dataType:"json",header:{"content-type":"application/x-www-form-urlencoded"},success:function(c){if(0==c.data.code){var n=[];console.log(e.length);for(var o=0;o<e.length;o++)n.push({cart_id:e[o]});i.mch_list[0].mch_id=0,i.mch_list[0].goods_list=n,a==s.length-1&&(console.log(a),t.request({url:i.$api+"order/new-submit-preview&access_token="+i.$access_token,method:"POST",data:{mch_list:JSON.stringify(i.mch_list)},dataType:"json",header:{"content-type":"application/x-www-form-urlencoded"},success:function(i){if(1==i.data.code)return t.showToast({title:i.data.msg,icon:"none"}),!1;setTimeout(function(){t.navigateTo({url:"/pages/account/account?data="+JSON.stringify(i.data.data)})},1e3)}}))}else t.showToast({title:c.data.msg,icon:"none",duration:1500})}})},n=0;n<s.length;n++)c(n)}}}};i.default=e}).call(this,e("6e42")["default"])}},[["461b","common/runtime","common/vendor"]]]);